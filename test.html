<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>

    <style>
    .root {
        width: 100px;
        height: 100px;
        position: relative;
        font-size: 0;
        outline: 1px dotted #ccc;
        margin: auto;
        /*overflow: hidden;*/
        }
        .root__wrap {
            width: 100%;
            position: relative;
            }
            .root__layer {
                position: relative;
                width: 100%;
                white-space: nowrap;
                }
            .root__layer._effects {
                -webkit-transition:
                    left .3s cubic-bezier(0.1,0,.25,1),
                    -webkit-transform .3s cubic-bezier(0.1,0,.25,1);
                transition:
                    left .3s cubic-bezier(0.1,0,.25,1),
                    transform .3s cubic-bezier(0.1,0,.25,1);
                }
                .root__layer-slide {
                    display: none;
                    width: 100px;
                    height: 100px;
                    text-align: center;
                    font: 64px/100px Arial;
                    }
                .root__layer-slide._visible {
                    display: inline-block;
                    }
    .thumbs {
        text-align: center;
        font-size: 0;
        margin: 40px 0;
        }
        .thumb {
            position: relative;
            width: 20px;
            height: 20px;
            display: inline-block;
            cursor: pointer;
            }
        .thumb:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 8px;
            height: 8px;
            border-radius: 4px;
            background: #000;
            }
        .thumb:hover:before {
            background: #666;
            }

    </style>
</head>
<body>

<div class="root">
    <div class="root__wrap">
        <div class="root__layer">
            <div class="root__layer-slide _0">0</div>
            <div class="root__layer-slide _1">1</div>
            <div class="root__layer-slide _2">2</div>
            <div class="root__layer-slide _3">3</div>
            <div class="root__layer-slide _4">4</div>
            <div class="root__layer-slide _5">5</div>
            <div class="root__layer-slide _6">6</div>
            <div class="root__layer-slide _7">7</div>
            <div class="root__layer-slide _8">8</div>
            <div class="root__layer-slide _9">9</div>
        </div>
    </div>
</div>

<div class="thumbs">
    <div class="thumb" data-rel="0"></div>
    <div class="thumb" data-rel="1"></div>
    <div class="thumb" data-rel="2"></div>
    <div class="thumb" data-rel="3"></div>
    <div class="thumb" data-rel="4"></div>
    <div class="thumb" data-rel="5"></div>
    <div class="thumb" data-rel="6"></div>
    <div class="thumb" data-rel="7"></div>
    <div class="thumb" data-rel="8"></div>
    <div class="thumb" data-rel="9"></div>
</div>

<script src="libs/jquery/jquery.js"></script>
<script>

$(document).ready(function() {

    var layer = $('.root__layer');

    current = 0;
    count = 9;
    baseIndent = current == 0 ? 0 : -1;
    extIndent = 0;

    isAnimate = 0;

    layer[0].addEventListener('webkitTransitionEnd', debounce(end, 300), false);

    function calcIndent(target) {
        var indent = 0;

        if (target > current) {
            if (target - current == 1) {
                indent = -1;
            } else {
                indent = -2;
            }
        }

        if (target < current) {
            if (current - target == 1) {
                indent = 1;
            } else {
                indent = 2;
            }
        }

        // console.log(current, target, indent * 100);

        return (baseIndent + indent);
    }

    function go(target) {
        if (isAnimate && target < current) {
            extIndent--;
        }

        isAnimate = 1;

        $('._' + target).addClass('_visible');

        $('.root__wrap').css('left', extIndent * 100 + '%')

        layer
            .addClass('_effects')
            .css({
                'transform': 'translate3d(' + calcIndent(target) * 100 + '%, 0, 0)'
            });


        baseIndent = calcIndent(target);

        current = target;

        // console.log(current);
    }

    function debounce(fn, timeout, invokeAsap, ctx) {
        if (arguments.length == 3 && typeof invokeAsap != 'boolean') {
            ctx = invokeAsap;
            invokeAsap = false;
        }

        var timer;

        return function() {
            var args = arguments;

            ctx = ctx || this;
            if (invokeAsap && !timer) {
                fn.apply(ctx, args);
            }

            clearTimeout(timer);

            timer = setTimeout(function() {
                if (!invokeAsap) {
                    fn.apply(ctx, args);
                }
                timer = null;
            }, timeout);
        };
    }

    function end() {
        console.log('END');
        var finalIndent = -100;

        extIndent = 0;
        isAnimate = 0;

        if (current == 0) {
            finalIndent = 0;
        }

        baseIndent = current == 0 ? 0 : -1;

        for (var i = 0; i <= count; i++) {
            var elem = $('._' + i);

            if (i == current - 1 || i == current || i == current + 1) {
                elem.addClass('_visible');
            } else {
                elem.removeClass('_visible');
            }
        }

        layer
            .removeClass('_effects')
            .css({
                'transform': 'translate3d(' + finalIndent + '%, 0, 0)'
            });

        $('.root__wrap').css('left', 0);
    }

    go(0);

    $(window).on('keydown', function(e) {
        var key = e.which || e.keyCode;

        switch(key) {
            // Space
            case 32:
                if (current < count) go(current + 1);
                break;

            // Left
            case 37:
                if (current > 0) go(current - 1);
                break;

            // Right
            case 39:
                if (current < count) go(current + 1);
                break;
        }
    });

    $('.thumb').on('click', function() {
        var target = $(this).attr('data-rel');

        go(target);
    });

});

</script>
</body>
</html>