!function(a){"use strict";if(window){var b,c=[],d={init:function(e){return b=a.extend({current:0,count:0,loadingRange:1,slideIdPrefix:"_"},e),this.each(function(e){var f=a(this),g=this.id||e,h={},i="",j=0;h.root=f,h.control=f.find("."+b.control),h.next=f.find("."+b.next),h.prev=f.find("."+b.prev),h.thumb=f.find("."+b.thumb),h.thumbImg=f.find("."+b.thumbImg),h.viewport=f.find("."+b.viewport),h.layer=f.find("."+b.layer),h.gallery=[],h.thumb.each(function(c){h.gallery.push({url:this.href,width:0,height:0,loaded:!1}),i+=d.getTemplate(c),j++,a(this).attr("data-rel",c).addClass(b.slideIdPrefix+c)}),h.layer.html(i),h.slide=f.find("."+b.slide),h.current=b.current,h.count=j-1,h.dragging=!1,h.allowClick=!0,h.viewportWidth=h.viewport.outerWidth(),h.viewportHeight=h.viewport.outerHeight(),c[g]=h,d.handlers(g),d.go(g,h.current,0)})},destroy:function(){a("."+b.next).off(),a("."+b.prev).off(),a("."+b.thumb).off()},handlers:function(e){function f(){new Date-h<j?setTimeout(f,j):(i=!1,g.viewportWidth=g.viewport.outerWidth(),g.viewportHeight=g.viewport.outerHeight(),g.slide.each(function(a){d.position(e,a)}))}var g=c[e],h=new Date(1,1,2e3,12,0,0),i=!1,j=84;g.next.on("click",function(){console.log("click",g.allowClick),g.allowClick&&d.next(e)}),g.prev.on("click",function(){console.log("click",g.allowClick),g.allowClick&&d.prev(e)}),g.thumb.on("click",function(){var b=parseInt(a(this).attr("data-rel"));return d.go(e,b),!1}),b.swipe&&d.bindSwipe(e),b.keyboard&&d.bindKeyboard(e),a(window).on("resize",function(){h=new Date,i===!1&&(i=!0,setTimeout(f,j))})},bindSwipe:function(e){var f=c[e],g=0,h=0;f.dragging=!1,f.control.on("mouseup mouseleave",function(){if(f.root.removeClass(b.mod.dragging),f.dragging){var c,i,j=a(this),k=j.outerWidth();if(f.dragging=!1,c=g-h,i=c>0?f.current+1:f.current-1,0==c)return f.allowClick=!0,void 0;f.allowClick=!1,setTimeout(function(){f.allowClick=!0},20),Math.abs(c)>.05*k?c>0?d.next(e):d.prev(e):d.go(e,f.current)}}),f.control.on("mousemove",function(b){if(f.dragging){var c,d,e,i=a(this),j=i.outerWidth(),k=i.offset();h=b.pageX-k.left,c=g-h,d=-c/j*100,e=100*-f.current+d,f.layer.css("left",e+"%")}}),f.control.on("mousedown",function(c){var d=a(this).offset();g=h=c.pageX-d.left,f.dragging=!0,f.root.addClass(b.mod.dragging)})},bindKeyboard:function(b){c[b];a(window).on("keydown",function(){var a=event.which||event.keyCode;switch(a){case 32:d.next(b);break;case 37:d.prev(b);break;case 39:d.next(b)}})},go:function(a,e,f){var g=c[a];void 0===f&&(f=b.delay),g.layer.css("transition-duration",f+"ms").css("left",100*-e+"%"),g.current=e,g.slide.removeClass(b.mod.current),g.slide.filter(b.slideIdPrefix+e).addClass(b.mod.current),d.loadSlides(a,e),setTimeout(function(){g.layer.css("transition-duration","0s")},f)},next:function(a){var b=c[a];b.current<b.count?d.go(a,b.current+1):d.go(a,b.current)},prev:function(a){var b=c[a];b.current>0?d.go(a,b.current-1):d.go(a,b.current)},loadSlides:function(a,e){for(var f=c[a],g=(b.loadingRange,0>e-1?0:e-1),h=e+1>f.count?f.count:e+1,i=g;h>=i;i++)f.gallery[i].loaded||d.loadSlide(a,i)},loadSlide:function(e,f){var g=c[e],h=g.root.find("."+b.slide+"."+b.slideIdPrefix+f),i=g.gallery[f].url,j=document.createElement("img");!function(c){var f=a(j);f.on("load",function(){g.gallery[c].loaded=!0,g.gallery[c].width=this.width,g.gallery[c].height=this.height,h.css("background-image","url("+this.src+")").removeClass(b.mod.loading),d.position(e,c)}).on("error",function(){})}(f),j.src=i},position:function(a,d){var e=c[a],f=e.root.find("."+b.slide+"."+b.slideIdPrefix+d),g=e.gallery[d],h=e.viewportWidth/e.viewportHeight,i=g.width/g.height;e.viewportWidth>g.width&&e.viewportHeight>g.height?f.removeClass(b.mod.auto).addClass(b.mod.center):f.removeClass(b.mod.center).addClass(b.mod.auto),i>=h?f.removeClass(b.mod.portrait).addClass(b.mod.landscape):f.removeClass(b.mod.landscape).addClass(b.mod.portrait)},getTemplate:function(a){return'<div class="'+b.slide+" "+b.slideIdPrefix+a+" "+b.mod.loading+'" data-id="'+a+'"></div>'}};a.fn.photor=function(b){return d[b]?d[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error("Unknown method: "+b),void 0):d.init.apply(this,arguments)}}}(jQuery);