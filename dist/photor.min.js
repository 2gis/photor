!function(a){"use strict";function b(){for(var a in e)if(void 0!==document.createElement("div").style[a])return a;return!1}if(window){var c,d,e={transform:"transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",WebkitTransform:"-webkit-transform"},f=[],g=!1;document.addEventListener("touchstart",function(){g=(new Date).getMilliseconds()},!1),function(){var a=!1;document.addEventListener("touchstart",function(){a=!0},!1),document.addEventListener("touchmove",function(){a=!1},!1),document.addEventListener("touchend",function(b){if(a){a=!1;var c=document.createEvent("CustomEvent");c.initCustomEvent("fastclick",!0,!0,b.target),b.target.dispatchEvent(c),b.preventDefault()}},!1)}();var h={init:function(d){return c=a.extend({current:0,count:0,loadingRange:2,slideIdPrefix:"_",transform:b()},d),this.each(function(b){var d=a(this),e=this.id||b,g={},i="",j=0,k=[];g.root=d,g.control=d.find("."+c.control),g.next=d.find("."+c.next),g.prev=d.find("."+c.prev),g.thumbs=d.find("."+c.thumbs),g.thumbsLayer=d.find("."+c.thumbsLayer),g.thumb=d.find("."+c.thumb),g.thumbImg=d.find("."+c.thumbImg),g.thumbFrame=d.find("."+c.thumbFrame),g.viewport=d.find("."+c.viewport),g.layer=d.find("."+c.layer),g.gallery=[],g.thumb.each(function(b){var d=a(this),e=d.find("."+c.thumbImg)[0];g.gallery.push({url:this.href,width:0,height:0,loaded:!1}),i+=h.getTemplate(b),j++,d.attr("data-rel",b).addClass(c.slideIdPrefix+b),k[b]=e.src}),g.layer.html(i),g.slide=d.find("."+c.slide),g.current=c.current,g.count=j-1,g.dragging=!1,g.allowClick=!0,g.viewportWidth=g.viewport.outerWidth(),g.viewportHeight=g.viewport.outerHeight(),g.thumbSrc=k,f[e]=g,h.loadThumbs(e),h.handlers(e),h.go(e,g.current,0),c.swipe&&h.checkThumbs(e)})},destroy:function(){a("."+c.next).off(),a("."+c.prev).off(),a("."+c.thumb).off()},handlers:function(b){function d(){new Date-g<j?setTimeout(d,j):(i=!1,e.viewportWidth=e.viewport.outerWidth(),e.viewportHeight=e.viewport.outerHeight(),e.slide.each(function(a){h.position(b,a)}),c.swipe&&h.checkThumbs(b))}var e=f[b],g=new Date(1,1,2e3,12,0,0),i=!1,j=84;e.next.on("click fastclick",function(){e.allowClick&&h.next(b)}),e.prev.on("click fastclick",function(){e.allowClick&&h.prev(b)}),e.thumb.on("click fastclick",function(c){if(c.preventDefault(),e.allowClick){var d=parseInt(a(this).attr("data-rel"));h.go(b,d)}return!1}),c.swipe&&h.bindSwipe(b),c.keyboard&&h.bindKeyboard(b),a(window).on("resize",function(){g=new Date,i===!1&&(i=!0,setTimeout(d,j))})},bindSwipe:function(b){function d(a){n.allowClick=!1;var b,c,d=a.outerWidth();b=-q.x/d*100,c=100*-n.current+b,n.layer.css(h.setIndent(c))}function e(a){var c,d=a.outerWidth();c=q.x>0?n.current+1:n.current-1,Math.abs(q.x)>.05*d?q.x>0?h.next(b):h.prev(b):h.go(b,n.current)}function g(){{var a;n.thumbs.outerWidth()}a=-q.x+s,n.thumbsLayer.css(h.setIndent(a,"px"))}function i(a){var b,c;n.thumbsDragging&&(s=h.getThumbsPosition(a),m=new Date,b=h.getThumbsPosition(n.thumbsLayer),c=q.x>0?-1:1,n.thumbsLayer.css("transition-duration",".3s").css(h.setIndent(j(b,c),"px")))}function j(a,b){var c=b*parseInt(Math.pow(10*q.x/(m-l),2))+a,d=n.thumbs.outerWidth()-n.thumbsLayer.outerWidth();return c>0?0:d>c?d:c}var k,l,m,n=f[b],o=n.root.find("."+c.control+", ."+c.thumbsLayer),p={},q={},r=!1,s=0;n.dragging=!1,o.on("mousedown touchstart",function(b){{var d=a(this);d.offset()}return p={x:b.pageX||b.originalEvent.touches[0].pageX,y:b.pageY||b.originalEvent.touches[0].pageY},q={x:0,y:0},d.hasClass(c.thumbsLayer)&&n.thumbsDragging&&(s=h.getThumbsPosition(d),l=new Date,n.thumbsLayer.css("transition-duration","0s")),"touchstart"==b.type?!0:(n.dragging=!0,void n.root.addClass(c.mod.dragging))}).on("mousemove touchmove",function(b){var e=b.originalEvent.touches&&b.originalEvent.touches.length,f=b.pageX||b.originalEvent.touches&&b.originalEvent.touches[0].pageX,h=b.pageY||b.originalEvent.touches&&b.originalEvent.touches[0].pageY;if(q={x:p.x-f,y:p.y-h},"undefined"==typeof k&&(k=!!(k||Math.abs(q.x)<Math.abs(q.y))),r=r||e>1,!k&&!r&&0!=e&&(b.preventDefault(),"touchmove"!=b.type||n.dragging||(n.dragging=!0,n.root.addClass(c.mod.dragging)),n.dragging)){var i=a(this);i.hasClass(c.thumbsLayer)?n.thumbsDragging&&g(i):d(i)}}).on("mouseup mouseleave touchend touchcancel",function(b){if(n.root.removeClass(c.mod.dragging),k=void 0,r=1==(b.originalEvent.touches&&b.originalEvent.touches.length),n.dragging){var d=a(this);if(n.dragging=!1,0==q.x)return n.allowClick=!0,!0;n.allowClick=!1,setTimeout(function(){n.allowClick=!0},20),d.hasClass(c.thumbsLayer)?i(d):e(d)}}),n.thumbImg.on("dragstart",function(){return!1})},checkThumbs:function(a){var b,c=f[a],d=c.thumbs.outerWidth(),e=c.thumbsLayer.outerWidth(),g=d-e;d>e?(c.thumbsDragging=!1,c.thumbsLayer.css("transition-duration","0s").css(h.setIndent(0,"px"))):(b=h.getThumbsPosition(c.thumbsLayer),c.thumbsDragging=!0,g>b&&c.thumbsLayer.css("transition-duration","0s").css(h.setIndent(g,"px")))},getThumbsPosition:function(a){if(c.transform){var b=a.css(e[c.transform]);return parseFloat(b.substr(7,b.length-8).split(", ")[4])}return parseInt(a[0].style.left)},bindKeyboard:function(b){f[b];a(window).on("keydown",function(a){var c=a.which||a.keyCode;switch(c){case 32:h.next(b);break;case 37:h.prev(b);break;case 39:h.next(b)}})},go:function(a,b,e){var g=f[a];void 0===e&&(e=c.delay),g.layer.css("transition-duration",e+"ms").css(h.setIndent(100*-b)),g.current=b,h.setCurrentThumb(a,b,e),g.slide.removeClass(c.mod.current),g.slide.filter("."+c.slideIdPrefix+b).addClass(c.mod.current),h.loadSlides(a,b),h.checkButtons(a),clearTimeout(d),d=setTimeout(function(){g.layer.css("transition-duration","0s")},e)},next:function(a){var b=f[a];b.current<b.count?h.go(a,b.current+1):h.go(a,b.current)},prev:function(a){var b=f[a];b.current>0?h.go(a,b.current-1):h.go(a,b.current)},loadSlides:function(a,b){for(var d=f[a],e=(c.loadingRange,0>b-1?0:b-1),g=b+1>d.count?d.count:b+1,i=e;g>=i;i++)d.gallery[i].loaded||h.loadSlide(a,i)},loadSlide:function(b,d){var e=f[b],g=e.root.find("."+c.slide+"."+c.slideIdPrefix+d+" "),i=g.find("."+c.slideImg),j=e.gallery[d].url,k=document.createElement("img");!function(d){var f=a(k);f.on("load",function(){e.gallery[d].loaded=!0,e.gallery[d].width=this.width,e.gallery[d].height=this.height,g.removeClass(c.mod.loading),h.position(b,d)}).on("error",function(){}),k.src=j,i.css("background-image","url("+k.src+")")}(d)},loadThumbs:function(b){var c=f[b],d=c.count,e=c.thumbSrc,g=document.createElement("img"),i=0;c.galleryThumbs=[],c.galleryThumbsLoaded=!1;for(var j=0;d>=j;j++)!function(f){var j=a(g);j.on("load",function(){i++,i==d&&(c.galleryThumbsLoaded=!0,h.getThumbsSize(b))}).on("error",function(){}),g.src=e[f]}(j)},getThumbsSize:function(b){var c=f[b],d=c.thumb;d.each(function(b){var d=a(this);c.galleryThumbs[b]={},c.galleryThumbs[b].width=d.outerWidth(),c.galleryThumbs[b].height=d.outerHeight(),c.galleryThumbs[b].top=d.position().top+parseInt(d.css("margin-top")),c.galleryThumbs[b].left=d.position().left+parseInt(d.css("margin-left"))}),h.setCurrentThumb(b,c.current)},setCurrentThumb:function(a,b){var d=f[a],g=d.thumbFrame,h={},i=d.galleryThumbs[b];d.galleryThumbsLoaded&&(h.width=i.width+"px",h.height=i.height+"px",c.transform?h[e[c.transform]]="translate3d("+i.left+"px, "+i.top+"px, 0)":(h.top=i.top+"px",h.left=i.left+"px"),g.css(h))},position:function(a,b){var d=f[a],e=d.root.find("."+c.slide+"."+c.slideIdPrefix+b),g=d.gallery[b],h=d.viewportWidth/d.viewportHeight,i=g.width/g.height;d.viewportWidth>g.width&&d.viewportHeight>g.height?e.removeClass(c.mod.auto).addClass(c.mod.center):e.removeClass(c.mod.center).addClass(c.mod.auto),i>=h?e.removeClass(c.mod.portrait).addClass(c.mod.landscape):e.removeClass(c.mod.landscape).addClass(c.mod.portrait)},checkButtons:function(a){var b=f[a];0==b.current?b.prev.addClass(c.mod.disabled):b.prev.removeClass(c.mod.disabled),b.current==b.count?b.next.addClass(c.mod.disabled):b.next.removeClass(c.mod.disabled)},setIndent:function(a,b){var d={};return b=b||"%",c.transform?d[e[c.transform]]="translate3d("+a+b+", 0, 0)":d.left=a+"%",d},getTemplate:function(a){return'<div class="'+c.slide+" "+c.slideIdPrefix+a+" "+c.mod.loading+'" data-id="'+a+'"><div class="'+c.slideImg+'"></div></div>'}};a.fn.photor=function(b){return h[b]?h[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Unknown method: "+b):h.init.apply(this,arguments)}}}(jQuery);