!function(a){"use strict";function b(){for(var a in d)if(void 0!==document.createElement("div").style[a])return a;return!1}if(window){var c,d={transform:"transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",WebkitTransform:"-webkit-transform"},e=[],f={init:function(d){return c=a.extend({current:0,count:0,loadingRange:1,slideIdPrefix:"_",transform:b()},d),this.each(function(b){var d=a(this),g=this.id||b,h={},i="",j=0;h.root=d,h.control=d.find("."+c.control),h.next=d.find("."+c.next),h.prev=d.find("."+c.prev),h.thumb=d.find("."+c.thumb),h.thumbImg=d.find("."+c.thumbImg),h.viewport=d.find("."+c.viewport),h.layer=d.find("."+c.layer),h.gallery=[],h.thumb.each(function(b){h.gallery.push({url:this.href,width:0,height:0,loaded:!1}),i+=f.getTemplate(b),j++,a(this).attr("data-rel",b).addClass(c.slideIdPrefix+b)}),h.layer.html(i),h.slide=d.find("."+c.slide),h.current=c.current,h.count=j-1,h.dragging=!1,h.allowClick=!0,h.viewportWidth=h.viewport.outerWidth(),h.viewportHeight=h.viewport.outerHeight(),e[g]=h,f.handlers(g),f.go(g,h.current,0)})},destroy:function(){a("."+c.next).off(),a("."+c.prev).off(),a("."+c.thumb).off()},handlers:function(b){function d(){new Date-h<j?setTimeout(d,j):(i=!1,g.viewportWidth=g.viewport.outerWidth(),g.viewportHeight=g.viewport.outerHeight(),g.slide.each(function(a){f.position(b,a)}))}var g=e[b],h=new Date(1,1,2e3,12,0,0),i=!1,j=84;g.next.on("click",function(){g.allowClick&&f.next(b)}),g.prev.on("click",function(){g.allowClick&&f.prev(b)}),g.thumb.on("click",function(){var c=parseInt(a(this).attr("data-rel"));return f.go(b,c),!1}),c.swipe&&f.bindSwipe(b),c.keyboard&&f.bindKeyboard(b),a(window).on("resize",function(){h=new Date,i===!1&&(i=!0,setTimeout(d,j))})},bindSwipe:function(b){function d(a){var b=a.changedTouches[0],c=document.createEvent("MouseEvent");c.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[a.type],!0,!0,window,1,b.screenX,b.screenY,b.clientX,b.clientY,!1,!1,!1,!1,0,null),b.target.dispatchEvent(c),a.preventDefault()}var g=e[b],h=0,i=0;g.dragging=!1,g.control.on("mouseup mouseleave",function(){if(g.root.removeClass(c.mod.dragging),g.dragging){var d,e,j=a(this),k=j.outerWidth();if(g.dragging=!1,d=h-i,e=d>0?g.current+1:g.current-1,0==d)return g.allowClick=!0,void 0;g.allowClick=!1,setTimeout(function(){g.allowClick=!0},20),Math.abs(d)>.05*k?d>0?f.next(b):f.prev(b):f.go(b,g.current)}}),g.control.on("mousemove",function(b){if(g.dragging){var c,d,e,j=a(this),k=j.outerWidth(),l=j.offset();i=b.pageX-l.left,c=h-i,d=-c/k*100,e=100*-g.current+d,g.layer.css(f.setIndent(e))}}),g.control.on("mousedown",function(b){var d=a(this).offset();h=i=b.pageX-d.left,g.dragging=!0,g.root.addClass(c.mod.dragging)}),g.control[0].addEventListener("touchstart",d,!0),g.control[0].addEventListener("touchmove",d,!0),g.control[0].addEventListener("touchend",d,!0),g.control[0].addEventListener("touchcancel",d,!0)},bindKeyboard:function(b){e[b];a(window).on("keydown",function(){var a=event.which||event.keyCode;switch(a){case 32:f.next(b);break;case 37:f.prev(b);break;case 39:f.next(b)}})},go:function(a,b,d){var g=e[a];void 0===d&&(d=c.delay),g.layer.css("transition-duration",d+"ms").css(f.setIndent(100*-b)),g.current=b,g.slide.removeClass(c.mod.current),g.slide.filter(c.slideIdPrefix+b).addClass(c.mod.current),f.loadSlides(a,b),setTimeout(function(){g.layer.css("transition-duration","0s")},d)},next:function(a){var b=e[a];b.current<b.count?f.go(a,b.current+1):f.go(a,b.current)},prev:function(a){var b=e[a];b.current>0?f.go(a,b.current-1):f.go(a,b.current)},loadSlides:function(a,b){for(var d=e[a],g=(c.loadingRange,0>b-1?0:b-1),h=b+1>d.count?d.count:b+1,i=g;h>=i;i++)d.gallery[i].loaded||f.loadSlide(a,i)},loadSlide:function(b,d){var g=e[b],h=g.root.find("."+c.slide+"."+c.slideIdPrefix+d),i=g.gallery[d].url,j=document.createElement("img");!function(d){var e=a(j);e.on("load",function(){g.gallery[d].loaded=!0,g.gallery[d].width=this.width,g.gallery[d].height=this.height,h.css("background-image","url("+this.src+")").removeClass(c.mod.loading),f.position(b,d)}).on("error",function(){})}(d),j.src=i},position:function(a,b){var d=e[a],f=d.root.find("."+c.slide+"."+c.slideIdPrefix+b),g=d.gallery[b],h=d.viewportWidth/d.viewportHeight,i=g.width/g.height;d.viewportWidth>g.width&&d.viewportHeight>g.height?f.removeClass(c.mod.auto).addClass(c.mod.center):f.removeClass(c.mod.center).addClass(c.mod.auto),i>=h?f.removeClass(c.mod.portrait).addClass(c.mod.landscape):f.removeClass(c.mod.landscape).addClass(c.mod.portrait)},setIndent:function(a){var b={};return c.transform?b[d[c.transform]]="translate3d("+a+"%, 0, 0)":b.left=a+"%",b},getTemplate:function(a){return'<div class="'+c.slide+" "+c.slideIdPrefix+a+" "+c.mod.loading+'" data-id="'+a+'"></div>'}};a.fn.photor=function(b){return f[b]?f[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error("Unknown method: "+b),void 0):f.init.apply(this,arguments)}}}(jQuery);