!function(a){"use strict";function b(){for(var a in e)if(void 0!==document.createElement("div").style[a])return a;return!1}if(window){var c,d,e={transform:"transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",WebkitTransform:"-webkit-transform"},f=[];!function(){var a=!1;document.addEventListener("touchstart",function(){a=!0},!1),document.addEventListener("touchmove",function(){a=!1},!1),document.addEventListener("touchend",function(b){if(a){a=!1;var c=document.createEvent("CustomEvent");c.initCustomEvent("fastclick",!0,!0,b.target),b.target.dispatchEvent(c),b.preventDefault()}},!1)}();var g={init:function(d){return c=a.extend({current:0,count:0,loadingRange:2,slideIdPrefix:"_",transform:b()},d),this.each(function(b){var d=a(this),e=this.id||b,h={},i="",j=0,k=[];h.root=d,h.control=d.find("."+c.control),h.next=d.find("."+c.next),h.prev=d.find("."+c.prev),h.thumbs=d.find("."+c.thumbs),h.thumbsLayer=d.find("."+c.thumbsLayer),h.thumb=d.find("."+c.thumb),h.thumbImg=d.find("."+c.thumbImg),h.thumbFrame=d.find("."+c.thumbFrame),h.viewport=d.find("."+c.viewport),h.layer=d.find("."+c.layer),h.gallery=[],h.thumb.each(function(b){var d=a(this),e=d.find("."+c.thumbImg)[0];h.gallery.push({url:this.href,width:0,height:0,loaded:!1}),i+=g.getTemplate(b),j++,d.attr("data-rel",b).addClass(c.slideIdPrefix+b),k[b]=e.src}),h.layer.html(i),h.slide=d.find("."+c.slide),h.current=c.current,h.count=j-1,h.dragging=!1,h.allowClick=!0,h.viewportWidth=h.viewport.outerWidth(),h.viewportHeight=h.viewport.outerHeight(),h.thumbSrc=k,f[e]=h,g.loadThumbs(e),g.handlers(e),g.go(e,h.current,0),c.swipe&&g.checkThumbs(e)})},destroy:function(){a("."+c.next).off(),a("."+c.prev).off(),a("."+c.thumb).off()},handlers:function(b){function d(){new Date-h<j?setTimeout(d,j):(i=!1,e.viewportWidth=e.viewport.outerWidth(),e.viewportHeight=e.viewport.outerHeight(),e.slide.each(function(a){g.position(b,a)}),g.setCurrentThumb(b,e.current))}var e=f[b],h=new Date(1,1,2e3,12,0,0),i=!1,j=84;e.next.on("click fastclick",function(){e.allowClick&&!e.dragging&&g.next(b)}),e.prev.on("click fastclick",function(){e.allowClick&&!e.dragging&&(console.log("!!!"),g.prev(b))}),e.thumb.on("click fastclick",function(c){if(c.preventDefault(),e.allowClick){var d=parseInt(a(this).attr("data-rel"));g.go(b,d)}return!1}),c.swipe&&g.bindSwipe(b),c.keyboard&&g.bindKeyboard(b),a(window).on("resize",function(){h=new Date,i===!1&&(i=!0,setTimeout(d,j))})},bindSwipe:function(b){function d(a){n.allowClick=!1;var b,c,d=a.outerWidth();b=-q.x/d*100,c=100*-n.current+b,n.layer.css(g.setIndent(c))}function e(a){var c,d=a.outerWidth();c=q.x>0?n.current+1:n.current-1,Math.abs(q.x)>.05*d?q.x>0?g.next(b):g.prev(b):g.go(b,n.current)}function h(){{var a;n.thumbs.outerWidth()}a=-q.x+s,n.thumbsLayer.css(g.setIndent(a,"px"))}function i(a){var b,c;n.thumbsDragging&&(s=g.getThumbsPosition(a),m=new Date,b=g.getThumbsPosition(n.thumbsLayer),c=q.x>0?-1:1,n.thumbsLayer.css("transition-duration",".3s").css(g.setIndent(j(b,c),"px")))}function j(a,b){var c=b*parseInt(Math.pow(10*q.x/(m-l),2))+a,d=n.thumbs.outerWidth()-n.thumbsLayer.outerWidth();return c>0?0:d>c?d:c}var k,l,m,n=f[b],o=n.root.find("."+c.control+", ."+c.thumbsLayer),p={},q={},r=!1,s=0;n.dragging=!1,o.on("mousedown touchstart",function(b){{var d=a(this);d.offset()}if(!n.dragging){if(p={x:b.pageX||b.originalEvent.touches[0].pageX,y:b.pageY||b.originalEvent.touches[0].pageY},q={x:0,y:0},d.hasClass(c.thumbsLayer)&&n.thumbsDragging&&(s=g.getThumbsPosition(d),l=new Date,n.thumbsLayer.css("transition-duration","0s")),"touchstart"==b.type)return!0;n.dragging=!0,n.root.addClass(c.mod.dragging)}}).on("mousemove touchmove",function(b){var e=b.originalEvent.touches&&b.originalEvent.touches.length,f=b.pageX||b.originalEvent.touches&&b.originalEvent.touches[0].pageX,g=b.pageY||b.originalEvent.touches&&b.originalEvent.touches[0].pageY;if(q={x:p.x-f,y:p.y-g},"undefined"==typeof k&&(k=!!(k||Math.abs(q.x)<Math.abs(q.y))),r=r||e>1,!k&&!r&&0!=e&&(b.preventDefault(),"touchmove"!=b.type||n.dragging||(n.dragging=!0,n.root.addClass(c.mod.dragging)),n.dragging)){var i=a(this);i.hasClass(c.thumbsLayer)?n.thumbsDragging&&h(i):d(i)}}).on("mouseup mouseleave touchend touchcancel",function(b){if(n.root.removeClass(c.mod.dragging),k=void 0,r=1==(b.originalEvent.touches&&b.originalEvent.touches.length),n.dragging){var d=a(this);if(n.dragging=!1,0==q.x)return n.allowClick=!0,!0;n.allowClick=!1,setTimeout(function(){n.allowClick=!0},20),d.hasClass(c.thumbsLayer)?i(d):e(d)}}),n.thumbImg.on("dragstart",function(){return!1})},checkThumbs:function(a){var b,c=f[a],d=c.thumbs.outerWidth(),e=c.thumbsLayer.outerWidth(),h=d-e;d>e?(c.thumbsDragging=!1,c.thumbsLayer.css("transition-duration","0s").css(g.setIndent(0,"px"))):(b=g.getThumbsPosition(c.thumbsLayer),c.thumbsDragging=!0,h>b&&c.thumbsLayer.css("transition-duration","0s").css(g.setIndent(h,"px")))},getThumbsPosition:function(a){if(c.transform){var b=a.css(e[c.transform]);return parseFloat(b.substr(7,b.length-8).split(", ")[4])}return parseInt(a[0].style.left)},bindKeyboard:function(b){f[b];a(window).on("keydown",function(a){var c=a.which||a.keyCode;switch(c){case 32:g.next(b);break;case 37:g.prev(b);break;case 39:g.next(b)}})},go:function(a,b,e){var h=f[a];void 0===e&&(e=c.delay),h.layer.css("transition-duration",e+"ms").css(g.setIndent(100*-b)),h.current=b,g.setCurrentThumb(a,b),h.slide.removeClass(c.mod.current),h.slide.filter("."+c.slideIdPrefix+b).addClass(c.mod.current),g.loadSlides(a,b),g.checkButtons(a),clearTimeout(d),d=setTimeout(function(){h.layer.css("transition-duration","0s")},e)},next:function(a){var b=f[a];b.current<b.count?g.go(a,b.current+1):g.go(a,b.current)},prev:function(a){var b=f[a];b.current>0?g.go(a,b.current-1):g.go(a,b.current)},loadSlides:function(a,b){for(var d=f[a],e=(c.loadingRange,0>b-1?0:b-1),h=b+1>d.count?d.count:b+1,i=e;h>=i;i++)d.gallery[i].loaded||g.loadSlide(a,i)},loadSlide:function(b,d){var e=f[b],h=e.root.find("."+c.slide+"."+c.slideIdPrefix+d+" "),i=h.find("."+c.slideImg),j=e.gallery[d].url,k=document.createElement("img");!function(d){var f=a(k);f.on("load",function(){e.gallery[d].loaded=!0,e.gallery[d].width=this.width,e.gallery[d].height=this.height,h.removeClass(c.mod.loading),g.position(b,d)}).on("error",function(){}),k.src=j,i.css("background-image","url("+k.src+")")}(d)},loadThumbs:function(b){var c=f[b],d=c.count,e=c.thumbSrc,h=document.createElement("img"),i=0;c.galleryThumbs=[],c.galleryThumbsLoaded=!1;for(var j=0;d>=j;j++)!function(f){var j=a(h);j.on("load",function(){i++,i==d&&(c.galleryThumbsLoaded=!0,g.getThumbsSize(b))}).on("error",function(){}),h.src=e[f]}(j)},getThumbsSize:function(b){var c=f[b],d=c.thumb;d.each(function(b){var d=a(this);c.galleryThumbs[b]={},c.galleryThumbs[b].width=d.outerWidth(),c.galleryThumbs[b].height=d.outerHeight(),c.galleryThumbs[b].top=d.position().top+parseInt(d.css("margin-top")),c.galleryThumbs[b].left=d.position().left+parseInt(d.css("margin-left"))}),g.setCurrentThumb(b,c.current)},setCurrentThumb:function(a,b){function d(a){var b=m-n;return a>0?0:b>a?b:a}var h,i=f[a],j=i.thumbFrame,k={},l=i.galleryThumbs[b],m=i.thumbs.outerWidth(),n=i.thumbsLayer.outerWidth();i.galleryThumbsLoaded&&(k.width=l.width+"px",k.height=l.height+"px",c.transform?k[e[c.transform]]="translate3d("+l.left+"px, "+l.top+"px, 0)":(k.top=l.top+"px",k.left=l.left+"px"),h=-1*(l.left-.5*(m-l.width)),j.css(k),i.thumbsLayer.css("transition-duration",".3s").css(g.setIndent(d(h),"px")))},position:function(a,b){var d=f[a],e=d.root.find("."+c.slide+"."+c.slideIdPrefix+b),g=d.gallery[b],h=d.viewportWidth/d.viewportHeight,i=g.width/g.height;d.viewportWidth>g.width&&d.viewportHeight>g.height?e.removeClass(c.mod.auto).addClass(c.mod.center):e.removeClass(c.mod.center).addClass(c.mod.auto),i>=h?e.removeClass(c.mod.portrait).addClass(c.mod.landscape):e.removeClass(c.mod.landscape).addClass(c.mod.portrait)},checkButtons:function(a){var b=f[a];0==b.current?b.prev.addClass(c.mod.disabled):b.prev.removeClass(c.mod.disabled),b.current==b.count?b.next.addClass(c.mod.disabled):b.next.removeClass(c.mod.disabled)},setIndent:function(a,b){var d={};return b=b||"%",c.transform?d[e[c.transform]]="translate3d("+a+b+", 0, 0)":d.left=a+"%",d},getTemplate:function(a){return'<div class="'+c.slide+" "+c.slideIdPrefix+a+" "+c.mod.loading+'" data-id="'+a+'"><div class="'+c.slideImg+'"></div></div>'}};a.fn.photor=function(b){return g[b]?g[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?void a.error("Unknown method: "+b):g.init.apply(this,arguments)}}}(jQuery);